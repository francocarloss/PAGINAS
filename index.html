<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comunikids - Control de Niños</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      .container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        width: 300px;
        text-align: center;
      }
      h1 {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        text-align: left;
      }
      input {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ff6600; /* Borde naranja */
        border-radius: 4px;
      }
      input:focus {
        outline: none;
        border-color: #e65c00; /* tono más oscuro */
      }
      button {
        width: 100%;
        padding: 10px;
        background-color: #ff6600; /* Botón naranja */
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 5px;
      }
      button:hover {
        background-color: #e65c00; /* tono más oscuro */
      }
      .ticket {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #f9f9f9;
        /* Centrar todo el texto y hacerlo más grande */
        text-align: center;
      }
      .ticket h2 {
        font-size: 20px; /* Título en pantalla */
        margin-bottom: 10px;
      }
      .ticket p {
        font-size: 16px; /* Texto en pantalla */
        margin: 6px 0;
      }
      .hidden {
        display: none;
      }
      .print-button {
        margin-top: 10px;
        background-color: #007bff; /* Botón azul para imprimir */
      }
      .print-button:hover {
        background-color: #0056b3;
      }
      .pdf-button {
        margin-top: 10px;
        background-color: #8a2be2; /* Botón morado para PDF */
      }
      .pdf-button:hover {
        background-color: #6a1cb5;
      }
      /* Ajustes similares para la versión imprimible (ticketPrint) */
      .ticket-print {
        text-align: center;
      }
      .ticket-print h2 {
        font-size: 20px;
        margin-bottom: 10px;
      }
      .ticket-print p {
        font-size: 16px;
        margin: 6px 0;
      }
      @media print {
        body * {
          visibility: hidden;
        }
        .ticket-print,
        .ticket-print * {
          visibility: visible;
        }
        .ticket-print {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          border: none;
          box-shadow: none;
          padding: 0;
          margin: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Comunikids - Control de Niños</h1>
      <form id="childForm">
        <!-- Campos para el padre -->
        <label for="fatherFirstName">Nombre del Padre:</label>
        <input type="text" id="fatherFirstName" placeholder="Nombre" required />
        <input type="text" id="fatherLastName" placeholder="Apellido" required />

        <!-- Campos para el hijo -->
        <label for="childFirstName">Nombre del Hijo:</label>
        <input type="text" id="childFirstName" placeholder="Nombre" required />
        <input type="text" id="childLastName" placeholder="Apellido" required />

        <button type="submit">Generar Ticket</button>
      </form>

      <!-- Botón para generar reporte en Excel (acumula todos los registros) -->
      <button id="excelButton" onclick="exportToExcel()">Generar Reporte Excel</button>

      <div id="ticket" class="ticket hidden">
        <h2>Ticket de Entrega</h2>
        <p><strong>Nombre del Padre:</strong> <span id="ticketFatherName"></span></p>
        <p><strong>Nombre del Hijo:</strong> <span id="ticketChildName"></span></p>
        <p><strong>Número de Ticket:</strong> <span id="ticketNumber"></span></p>
        <p><strong>Fecha y Hora:</strong> <span id="ticketDateTime"></span></p>

        <button class="print-button" onclick="printTicket()">Imprimir Ticket</button>
        <button class="pdf-button" onclick="generatePDF()">Generar PDF</button>
      </div>

      <!-- Contenido para imprimir -->
      <div id="ticketPrint" class="ticket-print hidden">
        <h2>Comunikids - Ticket de Entrega</h2>
        <p><strong>Padre:</strong> <span id="printFatherName"></span></p>
        <p><strong>Hijo:</strong> <span id="printChildName"></span></p>
        <p><strong>Número:</strong> <span id="printTicketNumber"></span></p>
        <p><strong>Fecha y Hora:</strong> <span id="printDateTime"></span></p>
      </div>
    </div>

    <!-- Librería jsPDF para generar PDF desde el navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
      let ticketCounter = 1;
      // Arreglo para guardar todas las entradas (para Excel):
      let entries = [];

      // Objeto para el ticket actual (para PDF):
      let currentTicketData = {
        father: "",
        child: "",
        ticketNumber: "",
        dateTime: ""
      };

      document.getElementById("childForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const fatherFirstName = document.getElementById("fatherFirstName").value.trim();
        const fatherLastName = document.getElementById("fatherLastName").value.trim();
        const childFirstName = document.getElementById("childFirstName").value.trim();
        const childLastName = document.getElementById("childLastName").value.trim();

        if (fatherFirstName && fatherLastName && childFirstName && childLastName) {
          const fatherFullName = fatherFirstName + " " + fatherLastName;
          const childFullName = childFirstName + " " + childLastName;

          // Obtener fecha y hora actual
          const dateTimeNow = new Date().toLocaleString();

          // Mostramos datos en el ticket
          document.getElementById("ticketFatherName").textContent = fatherFullName;
          document.getElementById("ticketChildName").textContent = childFullName;
          document.getElementById("ticketNumber").textContent = ticketCounter;
          document.getElementById("ticketDateTime").textContent = dateTimeNow;

          // Mostramos datos en la versión de impresión
          document.getElementById("printFatherName").textContent = fatherFullName;
          document.getElementById("printChildName").textContent = childFullName;
          document.getElementById("printTicketNumber").textContent = ticketCounter;
          document.getElementById("printDateTime").textContent = dateTimeNow;

          document.getElementById("ticket").classList.remove("hidden");

          // Guardamos en el arreglo para Excel
          entries.push({
            fatherFirstName,
            fatherLastName,
            childFirstName,
            childLastName,
            ticket: ticketCounter
          });

          // Guardamos datos en currentTicketData (para PDF)
          currentTicketData.father = fatherFullName;
          currentTicketData.child = childFullName;
          currentTicketData.ticketNumber = ticketCounter;
          currentTicketData.dateTime = dateTimeNow;

          // Incrementamos contador
          ticketCounter++;

          // Limpiamos formulario para ingresar nuevos datos
          document.getElementById("childForm").reset();
        } else {
          alert("Por favor, ingresa el nombre y apellido del padre y del hijo.");
        }
      });

      function printTicket() {
        document.getElementById("ticketPrint").classList.remove("hidden");
        window.print();
        document.getElementById("ticketPrint").classList.add("hidden");
      }

      // Función para exportar el reporte a Excel (CSV) con TODOS los registros
      function exportToExcel() {
        let csvContent = "NombrePadre,ApellidoPadre,NombreHijo,ApellidoHijo,Ticket\n";
        entries.forEach((entry) => {
          csvContent += [
            entry.fatherFirstName,
            entry.fatherLastName,
            entry.childFirstName,
            entry.childLastName,
            entry.ticket
          ].join(",") + "\n";
        });

        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "reporte_comunikids.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      // Función para generar PDF del ticket actual (SOLO los datos actuales)
      function generatePDF() {
        // 1) Creamos el PDF en modo "landscape" (horizontal), con unidad de puntos, en papel A4
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("landscape", "pt", "a4");

        // 2) Obtenemos el ancho y alto total de la página
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();

        // 3) Calculamos el centro
        const centerX = pageWidth / 2;
        const centerY = pageHeight / 2;

        // 4) Título mucho más grande (por ejemplo, 32 pt)
        doc.setFontSize(32);
        doc.text("Comunikids - Ticket de Entrega", centerX, centerY - 70, {
          align: "center",
        });

        // 5) Texto más grande para el resto (por ejemplo, 20 pt)
        doc.setFontSize(20);

        // Definimos espacio entre líneas
        const lineSpacing = 40;
        // Comenzamos un poco más abajo del título
        let yPos = centerY - 20;

        doc.text("Nombre del Padre: " + currentTicketData.father, centerX, yPos, {
          align: "center",
        });
        yPos += lineSpacing;

        doc.text("Nombre del Hijo: " + currentTicketData.child, centerX, yPos, {
          align: "center",
        });
        yPos += lineSpacing;

        doc.text("Número de Ticket: " + currentTicketData.ticketNumber, centerX, yPos, {
          align: "center",
        });
        yPos += lineSpacing;

        doc.text("Fecha y Hora: " + currentTicketData.dateTime, centerX, yPos, {
          align: "center",
        });

        // 6) Nombre de archivo con el hijo
        const childNameForFile = currentTicketData.child.replace(/\s+/g, "_");
        doc.save("Ticket_Comunikids_" + childNameForFile + ".pdf");
      }
    </script>
  </body>
</html>
